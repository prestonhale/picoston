pico-8 cartridge // http://www.pico-8.com
version 39
__lua__
#include tyler.p8
#include michael.p8
#include preston.p8
#include evan.p8

#include collider.p8

-- animals
#include ostrich.p8
#include bee.p8
#include elephant.p8

-- enemies
#include enemy.p8

objects = {}

speed = 1

SPAWN_FUNCTIONS = {
    add_ostrich_in_lane,
    add_bee_giant_in_lane,
    add_elephant_in_lane,
    add_monkey_in_lane,
    add_bee_giant_in_lane
}

ANIMAL_COST = {
    0,
    1,
    4,
    0,
    0
}

LANE_Y_VALUES = {
    12,
    27,
    43,
    61,
    83
}

function _init()
    init_michael(objects)
    init_preston(objects)

    init_evan(objects)
end

function _update()
    check_collisions()

    for obj in all(objects) do
        obj:update()
    end
end

function _draw()
    local foreground = {}
    for obj in all(objects) do
        -- don't render yet if obj is tagged "foreground"
        if obj.foreground then 
            add(foreground, obj) 
            return
        end
        obj:draw()
    end
    -- draw foreground objects
    for obj in all(foreground) do
        obj:draw()
    end
end

function check_collisions()
    for i=1,#objects do
        for j=i+1,#objects do
            obj=objects[i]
            other=objects[j]
            --if a table isn't given a specific pixel width, give it a default
            if (other.pwidth==nil) then
                other.pwidth=16
            end
            if (obj.pwidth==nil) then
                obj.pwidth=16
            end
            if  obj.collider
                and other.collider
                and obj.lane_index == other.lane_index
                and obj.x < other.x + other.pwidth 
                and obj.x + obj.pwidth > other.x
                and obj.y < other.y + other.pwidth
                and obj.y + obj.pwidth > other.y
            then
                obj.collider:collide(other)
                other.collider:collide(obj)
            end
        end
    end
end

--- helper functions ---

function get_lane_y(lane_index)
    return LANE_Y_VALUES[lane_index]
end

-- temporary to reduce memory leakage
function remove_if_out_of_bounds(obj)
    if abs(64-obj.x)>80 or abs(64-obj.y)>80 then
        del(objects,obj)
    end
end
__gfx__
00000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000000008888880000005444400
0000000000000000000000000000000dd6600000eae000000000000000000000000000000000000000000000000000000000000000088888888880005f444400
007007000000000000000000000000dd666660000e000000000000000000000000000000000000000000000000000000000000000088866666688800ff444400
000770000000000000000000000000d66666600000000000000000000000000000000000000000000000000000000000000000000888877777768880ff444400
000770000000000000000000000006d6666766000000000000000000000000000000000000000000000000000000000000000000088888777777688000444400
007007000000000000000000000666d6666166000000000000000000000000000000000000000000000000000000000000000000886688877777768800044440
000000000000000000000000006666d6666666000000000000000000000000000000000000000000000000000000000000000000887768887777768800044440
000000000000000000000000066666dd6666d6600000000000000000000000000000000000000000000000000000000000000000887776888777768800044440
0000000000000000000000006066666dd6d6d6600c00000000000000000000000000000000000000000000000000000000000000887777688877768800044440
00000000000000000000000000666666ddd67760cac0000000000000000000000000000000000000000000000000000000000000887777768887768800044440
0000000000000000000000000066666666666d770c00000000000000000000000000000000000000000000000000000000000000887777776888768800044440
0000000000000000000000000066666666660d600000000000000000000000000000000000000000000000000000000000000000088777777688888000004444
00000000000000000000000000066666666d00600000000000000000000000000000000000000000000000000000000000000000088877777768888000004444
00000000000000000000000000066dd0066d00600000000000000000000000000000000000000000000000000000000000000000008887777768880000004444
00000000000000000000000000066dd0066d00000000000000000000000000000000000000000000000000000000000000000000000888888888800000004444
0000000000000000000000000006600000dd00000000000000000000000000000000000000000000000000000000000000000000000008888880000000054444
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000550000000005ffff0
0000000000000000000000000000000dd66000000000000000000000000000000000000000000000000000000000000000000000000000055000000000ffff00
000000000000000000000000000000dd666660000000000000000000000000000000000000000000000000000000000000000000000055555655000000fff000
000000000000000000000000000000d6666660000000000000000000000000000000000000000000000000000000000000000000000555555566500000000000
000000000000000000000000000006d6666766000000000000000000000000000000000000000000000000000000000000000000000055555555000000000000
000000000000000000000000000666d6666166000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000006666d6666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000066666dd6666d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000006066666dd6d6d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000666666ddd677600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000066666666666d770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000066666666660d600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000066666666d00600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000066dd0066d00600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000066dd0066d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000dd006600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f
00000000000000000000000000005550000000000000555000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066660000666650000000000555005000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000044440000000677776006777760000000000005005000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000444544000006777777667777776006666000066665000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000444554000006777777667777776067777600677776000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000444444000006777777667777776677777766777777600000000000000000000000000000000000000000000000000000000000000000000000000000000
0004444444aaa000a6777765a677776a677777766777777600000000000000000000000000000000000000000000000000000000000000000000000000000000
0044444444aaa000a56666a5aa666655677777766777777600000000000000000000000000000000000000000000000000000000000000000000000000000000
0445444400000000a5aa5aa5aaa5aa55a6777765a677776500000000000000000000000000000000000000000000000000000000000000000000000000000000
4445444440000000a5aa5aa5aaa5aaaaa56666a5aa6666aa00000000000000000000000000000000000000000000000000000000000000000000000000000000
4545444440000000a5aa5aa5aaa5aaaaa5aa5aa5aaa5aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000
444444fff000000005aa5aa5aaa5aaa005aa5aa5aaa5aaa000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444fff000000000050500000505000005050000050500000000000000000000000000000000000000000000000000000000000000000000000000000000000
00454f50000000000555500005555000055550000555500000000000000000000000000000000000000000000000000000000000000000000000000000000000
00050050000000000050000000500000005000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00050050000000005550000555500000555000055550000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000044444000000000004444400000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000004444000000044400044ffff000044400044ffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000
000004445440000004000044ff5f5f0004000044ff5f5f0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000004445540000004000ff4ffffff0004000ff4ffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000004444440000004000ff4fffffff004000ff4fffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004444444aaa000040000444ffffff0040000444ffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000
0044444444aaa0000400044444444400040004444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000
04454444000000000400044444444440040004444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000
4445444440000000040044444444f440040044444444f44000000000000000000000000000000000000000000000000000000000000000000000000000000000
45454444400000000400444444fff4400400444444fff44000000000000000000000000000000000000000000000000000000000000000000000000000000000
444444fff00000000404444f44fff0440404444f44fff04400000000000000000000000000000000000000000000000000000000000000000000000000000000
04444fff00000000044444ff44ff0044044444ff44ff004400000000000000000000000000000000000000000000000000000000000000000000000000000000
00454f50000000000000440044f00044000044000444004400000000000000000000000000000000000000000000000000000000000000000000000000000000
00050055000000000000440044000044000044000044004400000000000000000000000000000000000000000000000000000000000000000000000000000000
00500005000000000000440f44f00f44000044000ff40f440000000000000000000000000000000000000000000000000000000000000000000000000000000f
000004440000000000000000000000003bbbbb3bbb3bbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000
00004444400044400000044400004440b3bbbbbbbbbb33b300000000000000000000000000000000000000000000000000000000000000000000000000000000
00000ff5000444440000444440044444b33bb3bb3b33633b00000000000000000000000000000000000000000000000000000000000000000000000000000000
000066660000ff5000000ff50000ff5036633633636ff63300000000000000000000000000000000000000000000000000000000000000000000000000000000
00060666000066600000066600006660fff6ff6ff66fff6600000000000000000000000000000000000000000000000000000000000000000000000000000000
00044466000006600000666604446660ffffffffffff6fff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00444441044406600004446644444660fffffffffff6ffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
000ff50144444010004444410ff51010fff66fffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
006666010ff51010000ff50166661010fffff6ffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
06066600666640400066660606664040fffffffff6ffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00066606066640400606664406664040ffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00011100066600000006660001010000ff66fffffffffff600000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010001010000000101000101000066ffff66336fff6f00000000000000000000000000000000000000000000000000000000000000000000000000000000
000404000101000000010100040400006ffff3b3bb36f33600000000000000000000000000000000000000000000000000000000000000000000000000000000
0044040004040000000404004404000036ff63bbbbb33bb300000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000440400000044040000000000b3333bb3b3bbb33b00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000004440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000045454000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000044444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000044499900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00044444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04445444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04545444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044554fff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444fff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00054f50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00005005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00005005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49494949494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
94444444444444900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
94444444444444900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
94444444444444900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
94444444444444900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
94444444444444900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49494949494949400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f
__map__
a2a2a2a2a2a2a2a2a2a201010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a2a2a2a2a2a2a2a2a2a201010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
84858485848584858485a2a20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
94959495949594959495a2a2a200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8485848584858485848500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9495949594959495949500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8485848584858485848500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9495949594959495949500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8485848584858485848500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9495949594959495949500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
